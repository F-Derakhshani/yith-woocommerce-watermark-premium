jQuery(document).ready(function(t){var e,a=t(".ywcwat_product_collapse"),i=null,o=null,c=null,_=null;a.each(function(){t(this).toggleClass("expand").nextUntil("div.ywcwat_product_collapse").slideToggle(100)}),t(document).on("click",".ywcwat_product_collapse",function(){t(this).toggleClass("expand").nextUntil("div.ywcwat_product_collapse").slideToggle(100)});var n=function(t){var e=t.parents(".ywcwat_product_watermark_row").attr("id");return e},r=function(t){var e=t.find(".ywcwat_product_wat_url").val();return e},w=function(t){var e=t.find(".product_ywcwat_text"),a=t.find(".product_ywcwat_font_size"),i=t.find(".product_ywcwat_font_color"),o=t.find(".product_ywcwat_bg_color"),c=t.find(".product_ywcwat_opacity"),_=t.find(".product_ywcwat_box_width"),n=t.find(".product_ywcwat_box_height"),r=t.find(".product_ywcwat_line_height"),w=t.find(".product_ywcwat_font"),l=t.find(".ywcwat_text_angle"),p="rgba("+u(o.val())+","+h(o.val())+","+m(o.val())+","+c.val()/100+")",d={font_name:t.find(".product_ywcwat_font option:selected").text(),font_file_name:w.val(),font_size:a.val(),color_wat:i.val(),background_wat:p,width_box:_.val(),height_box:n.val(),text_wat:e.val(),line_height:r.val(),angle:l.val()};return d},l=function(t){var e,a,i=t.find(".ywcwat_preview_bg"),o=t.find(".ywcwat_product_size");switch(o.val()){case"shop_single":e=""==ywcwat_premium.shop_single.width?"auto":ywcwat_premium.shop_single.width+"px",a=""==ywcwat_premium.shop_single.height?"auto":ywcwat_premium.shop_single.height+"px";break;case"shop_catalog":e=""==ywcwat_premium.shop_catalog.width?"auto":ywcwat_premium.shop_catalog.width+"px",a=""==ywcwat_premium.shop_single.height?"auto":ywcwat_premium.shop_catalog.height;break;case"shop_thumbnail":e=""==ywcwat_premium.shop_thumbnail.width?"auto":ywcwat_premium.shop_thumbnail.width+"px",a=""==ywcwat_premium.shop_thumbnail.height?"auto":ywcwat_premium.shop_thumbnail.height+"px";break;case"full":}i.css({width:e,height:a})},p=function(e){var a=t("#"+n(e)),i=a.find(".ywcwat_select_type_wat").val(),o=a.find(".ywcwat_preview_watermark"),c=a.find(".ywcwat_settings_full_size"),_=a.find(".ywcwat_product_size").val();"full"==_?(a.find(".product_ywcwat_preview").hide(),c.show()):(a.find(".product_ywcwat_preview").show(),c.hide()),l(a);var p=o.parent().width(),s=o.parent().height();switch(i){case"type_img":var u=a.find(".ywcwat_repeat").is(":checked")?"repeat":"no-repeat";o.removeAttr("style"),"repeat"==u?(o.html(""),o.css({background:"url("+r(a)+")",width:"100%",height:"100%","background-repeat":u})):o.html('<img src="'+r(a)+'" />');break;case"type_text":o.removeAttr("style");var h,m=w(a),f=ywcwat_premium.gd_version>=2?"pt":"px",y=p*(m.width_box/100),g=s*(m.height_box/100);h=-1==m.line_height?g:m.line_height,o.html("<span>"+m.text_wat+"</span>"),o.css({"font-family":""==m.font_file_name?"inherit":m.font_name,"font-size":m.font_size+f,color:m.color_wat,"background-color":m.background_wat,width:y+"px",height:g+"px","line-height":h+"px"}),o.find("span").css({"-webkit-transform":"rotate(-"+m.angle+"deg )","-moz-transform":"rotate(-"+m.angle+"deg )","-ms-transform":"rotate(-"+m.angle+"deg )","-o-transform":"rotate(-"+m.angle+"deg )",display:"inline-block"})}d(e)},d=function(e){var a=t("#"+n(e)),i=a.find(".position_select"),o=a.find(".position_text"),c=a.find(".ywcwat_preview_bg"),_=c.find(".ywcwat_preview_watermark:eq(0)"),r=_.outerWidth(!0),w=_.outerHeight(!0),l=a.find(".product_ywcwat_pos_value:eq(0)"),p=a.find(".ywcwat_prod_margin_x").val(),d=a.find(".ywcwat_prod_margin_y").val(),s=0,u=0,h=0,m=0;i.hasClass("ywcwat_top_left")?(s="calc( 0px + "+d+"px )",u="calc( 0px + "+p+"px )",h="auto",m="auto",l.val("top_left"),o.html(ywcwat_premium.label_position.top_left)):i.hasClass("ywcwat_top_center")?(s="calc( 0px + "+d+"px )",u="calc( 50% - "+r/2+"px + "+p+"px )",h="auto",m="auto",l.val("top_center"),o.html(ywcwat_premium.label_position.top_center)):i.hasClass("ywcwat_top_right")?(s="calc( 0px + "+d+"px )",u="auto",h="calc( 0px + "+p+"px )",m="auto",l.val("top_right"),o.html(ywcwat_premium.label_position.top_right)):i.hasClass("ywcwat_middle_left")?(s="calc( 50% - "+w/2+"px + "+d+"px )",u="calc( 0px + "+p+"px )",h="auto",m="auto",l.val("middle_left"),o.html(ywcwat_premium.label_position.middle_left)):i.hasClass("ywcwat_middle_center")?(s="calc( 50% - "+w/2+"px + "+d+"px )",u="calc( 50% - "+r/2+"px + "+p+"px )",h="auto",m="auto",l.val("middle_center"),o.html(ywcwat_premium.label_position.middle_center)):i.hasClass("ywcwat_middle_right")?(s="calc( 50% - "+w/2+"px + "+d+"px )",u="auto",h="calc( 0px + "+p+"px )",m="auto",l.val("middle_right"),o.html(ywcwat_premium.label_position.middle_right)):i.hasClass("ywcwat_bottom_left")?(s="auto",u="calc( 0px + "+p+"px )",h="auto",m="calc( 0px + "+d+"px )",l.val("bottom_left"),o.html(ywcwat_premium.label_position.bottom_left)):i.hasClass("ywcwat_bottom_center")?(s="auto",u="calc( 50% - "+r/2+"px )",h="auto",m="calc( 0px + "+d+"px )",l.val("bottom_center"),o.html(ywcwat_premium.label_position.bottom_center)):(s="auto",u="auto",h="calc( 0px + "+p+"px )",m="calc( 0px + "+d+"px )",l.val("bottom_right"),o.html(ywcwat_premium.label_position.bottom_right)),_.css({top:s,bottom:m,left:u,right:h}),t("body").trigger("ywcwat_compute_position")},s=function(){t(".ywcwat_select_type_wat").on("change",function(e){var a=t(this),i=a.val(),o=t("#"+n(a)),c=o.find(".ywcwat_custom_wat_text_fields"),_=o.find(".ywcwat_custom_wat_img_fields"),r=o.find(".ywcwat_custom_general_fields"),w=o.find(".position_select");switch(i){case"type_text":_.hide(),c.show(),r.show();break;case"type_img":_.show(),c.hide(),r.show();break;case"no":_.hide(),c.hide(),r.hide()}p(w)}).change(),t(document).on("click",".ywcwat_product_image",function(a){a.preventDefault();var r=t(this),w=t("#"+n(r));if(i=w.find(".ywcwat_product_wat_url"),o=w.find('input:hidden[id^="ywcwat_product_image_hidden-"]'),c=w.find(".ywcwat_preview_watermark img"),_=w.find(".ywcwat_bottom_right"),e)return void e.open();var l=[new wp.media.controller.Library({library:wp.media.query({type:"image"}),multiple:!1,title:r.data("choose"),priority:20,filterable:"all"})];e=wp.media.frames.downloadable_file=wp.media({title:r.data("choose"),library:{type:"image"},button:{text:r.data("choose")},multiple:!1,states:l}),e.on("select",function(){var t=e.state().get("selection");t.map(function(t){t=t.toJSON(),t.url&&(o.val(t.id),c.attr("src",t.url),i.val(t.url),_.click(),p(r))})}),e.open()})},u=function(t){return parseInt(f(t).substring(0,2),16)},h=function(t){return parseInt(f(t).substring(2,4),16)},m=function(t){return parseInt(f(t).substring(4,6),16)},f=function(t){return"#"==t.charAt(0)?t.substring(1,7):t};t(document).on("click",".ywcwat_remove_product_watermark",function(e){e.preventDefault();var a=t(this),i=a.data("element_id"),o=window.confirm(ywcwat_premium.delete_single_watermark.confirm_delete_watermark);return o&&(t("#ywcwat_product_watermark_row-"+i).remove(),s()),!1}),t(document).on("click",".product_ywcwat_container_position tr td",function(e){var a=t(this),i=a.parent().parent();i.find("td").removeClass("position_select"),a.addClass("position_select"),p(a)}),t(document).on("change",".ywcwat_prod_margin_x, .ywcwat_prod_margin_y,.ywcwat_text_angle,.product_ywcwat_line_height,.product_ywcwat_font_size,.product_ywcwat_box_width,.product_ywcwat_box_height,.product_ywcwat_opacity, .product_ywcwat_font,.ywcwat_repeat",function(){var e=t(this);p(e)}),t(document).on("change paste keyup input focus",".product_ywcwat_text",function(){var e=t(this);p(e)}),t(document).on("change",".ywcwat_product_size",function(){p(t(this))}).change(),t(document).on("init_product_color_picker",function(){t(".product_colorpicker").wpColorPicker({change:function(e,a){p(t(this))}})}).trigger("init_product_color_picker"),t("#_ywcwat_product_enabled_watermark").is(":checked")?t(".show_if_custom_watermark_enabled").show():t(".show_if_custom_watermark_enabled").hide(),t(document).on("change","#_ywcwat_product_enabled_watermark",function(){var e=t(this);e.is(":checked")?t(".show_if_custom_watermark_enabled").show():t(".show_if_custom_watermark_enabled").hide()}),t(".iris-palette").on("click",function(){setTimeout(p(t(this),1))}),t("body").on("initial_product_position_watermark",function(){s()}),s()});