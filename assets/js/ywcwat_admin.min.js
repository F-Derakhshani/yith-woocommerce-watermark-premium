jQuery(document).ready(function(a){var e;a(document).on("click","#ywcwat_add_watermark",function(s){s.preventDefault();var t=a(this),r=a("#ywcwat_watermark_select"),c=a(".ywcwat_preview img");if(e)return void e.open();var w=[new wp.media.controller.Library({library:wp.media.query({type:"image/png"}),multiple:!1,title:t.data("choose"),priority:20,filterable:"all"})];e=wp.media.frames.downloadable_file=wp.media({title:t.data("choose"),library:{type:"image/png"},button:{text:t.data("choose")},multiple:!1,states:w}),e.on("select",function(){var s="",t="",w=e.state().get("selection");w.map(function(e){if(e=e.toJSON(),e.url){var w=e.width,o=e.height,i=1*ywcwat_params.perc_w,l=1*ywcwat_params.perc_h;if(l>0&&o>l||i>0&&w>i){a(".ywcwat_messages").removeClass("complete_task complete_all_task").addClass("error_size"),a(".ywcwat_icon").removeClass("dashicons-yes").addClass("dashicons dashicons-no");var _=ywcwat_params.messages.error_watermark_sizes;return a(".ywcwat_text").html(_),a(".ywcwat_messages").show(),!1}a(".ywcwat_messages").hide(),s=e.url,t=e.id,r.val(e.id),c.attr("src",e.url),a(".ywcwat_url").val(e.url)}})}),e.open()});var s=0;a(document).on("click",".ywcwat_apply_all_watermark",function(e){function t(e){var n={ywcwat_attach_id:e,action:ywcwat_params.actions.apply_all_watermark};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:n,dataType:"json",success:function(a){if(s==w&&"undefined"==typeof a.result&&(l.removeClass("complete_task").addClass("complete_all_task"),l.find(".ywcwat_icon").addClass("dashicons dashicons-yes"),l.find(".ywcwat_text").html(ywcwat_params.messages.complete_all_task),l.show(),r.prop("disabled",!1),o.hide()),"create_watermark"==a.result||"error_get_img_editor"==a.result||"error_save_img_resized"==a.result||"empty_path"==a.result||"skip"==a.result)if(o.progressbar("value",(s+1)/w*100),i.html(Math.round((s+1)/w*1e3)/10+"%"),_>m&&w>s)m++,s++,t(c[s]);else{r.prop("disabled",!1),o.hide(),l.addClass("complete_task"),l.find(".ywcwat_icon").addClass("dashicons dashicons-yes");var e=ywcwat_params.messages.complete_single_task+" "+s+" "+ywcwat_params.messages.more_product+" "+ywcwat_params.messages.on+" "+w;l.find(".ywcwat_text").html(e),l.show()}}})}e.preventDefault();var r=a(this),c=JSON.parse(ywcwat_params.attach_id),w=c.length,o=a("#ywcwat-progressbar_all"),i=a("#ywcwat-progressbar-percent_all"),l=a(".ywcwat_messages");l.hide(),o.progressbar(),i.html("0%"),o.show();var _=""==ywcwat_params.max_item_action?w:1*ywcwat_params.max_item_action;s==w&&(s=0);var m=0;r.prop("disabled",!0),t(c[s])}),a(document).on("click","#ywcwat_reset_watermark",function(){var e=(a(this),window.confirm(ywcwat_params.messages.reset_confirm));if(e){var s={ywcwat_remove_watermark:"remove",action:ywcwat_params.actions.remove_watermark};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:s,dataType:"json",success:function(e){a(".ywcwat_messages").addClass("complete_task"),a(".ywcwat_icon").addClass("dashicons dashicons-yes");var s;s=0==e.success||e.success>1?e.success+" "+ywcwat_params.messages.plural_success_image+", ":e.success+" "+ywcwat_params.messages.singular_success_image+", ",s+=0==e.error||e.error>1?e.error+" "+ywcwat_params.messages.plural_error_image+", ":e.error+" "+ywcwat_params.messages.singular_error_image+", ",a(".ywcwat_text").html(s),a(".ywcwat_messages").show()}})}})});